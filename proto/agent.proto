syntax = "proto3";

package pb;

option go_package = "github.com/mooncorn/nodelink/proto/pb";

service AgentService {
  rpc StreamCommunication(stream AgentMessage) returns (stream ServerMessage);
}

// Server to Agent messages
message ServerMessage {
  oneof message {
    Ping ping = 1;
    CommandRequest command_request = 2;
  }
}

// Agent to Server messages
message AgentMessage {
  oneof message {
    Pong pong = 1;
    CommandResponse command_response = 2;
  }
}

// Ping/Pong messages for heartbeat
message Ping {
  int64 timestamp = 1;
}

message Pong {
  int64 timestamp = 1;
  int64 ping_timestamp = 2;
}

// Command execution messages
message CommandRequest {
  string request_id = 1;
  string command = 2;
  repeated string args = 3;
  map<string, string> env = 4;
  string working_dir = 5;
  int32 timeout_seconds = 6;
}

message CommandResponse {
  string request_id = 1;
  int32 exit_code = 2;
  string stdout = 3;
  string stderr = 4;
  string error = 5;
  bool timeout = 6;
}
